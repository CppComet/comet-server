
# Отчёт о тесте в 64000 соединений онлайн

В прошлой статье мы рассмотрели [как провести нагрузочное тестирование](/docs/RU/%D0%9D%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B5%20%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/%D0%A1%D1%86%D0%B5%D0%BD%D0%B0%D1%80%D0%B8%D0%B9%20%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.md). А здесь я покажу как я его сам проводил, и приведу его результаты.


___
Нагрузка в 64000 это максимум который позволит создать операционная система при тестировании на одной машине. Если хотите больше то надо тестировать один сервер с нескольких машин одновременно. Так как TCP-соединение уникально определяется четверкой [source ip, source port, dest ip, dest port], таким образом с одной машины на 1 порт сервера можно создать не более 64 тыс одновременных соединений
___


# Результаты

На скриншоте видно 3 консоли. 
![Пик тестирования](https://comet-server.com/wiki/lib/exe/fetch.php/comet:снимок_экрана_от_2017-06-08_15-35-11.png)


  - В верхней я запустил tsung
  - Слева комет сервер
  - Справа htop

# Вывод комет сервера

На скриншоте цифрами обозначены

  - Количество соединений онлайн
  - Время работы сервера в секундах
  - Колонка со списком какой процесс сколько сетевых событий обработал за всё время. (таких как подключение, приём сообщений, закрытие соединения)
  - Первый процесс в списке обработал больше всех так как он занимался приёмом входящих соединений (При обычной нагрузке такого большого отрыва нет так как входящие подключение устанавливается на долго)
  - Остальные процессы для уже принятых соединений обрабатывали входящие сообщения
  - Колонка PcS обозначает какой процесс сколько сетевых событий обработал за последнею секунду (На gif анимации в этой колонке не нули) Нули так как соединения приняты и висят в ожидании входящих сообщений но данным тестовым сценарием мы не отсылаем каких то дополнительных событий.

![CppComet](https://comet-server.com/wiki/lib/exe/fetch.php/comet:out.png)

# Вывод htop

На скриншоте цифрами обозначены

  - Процессы комет сервера (Видно что он потратил 4891 Мб оперативной памяти)
  - Процессы tsung (Видно что он потратил 2262 Мб оперативной памяти)
  - Общее потребление памяти (Остальное было израсходовано операционной системой и другими программами запущенными в момент тестирования)

![htop](https://comet-server.com/wiki/lib/exe/fetch.php/comet:htop.png)


# Процесс тестирования

Gif анимация процесса тестирования. Видно что идёт прирост около 2500 соеденений в секунду и то что все ядра загружаются почти равномерно. Так же виден рост потребления памяти.

![https://comet-server.com/doc/CppComet/HL-test2-64000.gif](https://comet-server.com/doc/CppComet/HL-test2-64000.gif)

# Отчёт tsung


___
Ниже приведены только 2 графика, [полная версия отчёта](https://cppcomet.github.io/comet-server/HL-tests/HL-test1/20170608-1534/report.html) расположена на github.
___


# Запросов в секунду # 
![Запросов в секунду](https://cppcomet.github.io/comet-server/HL-tests/HL-test1/20170608-1534/images/graphes-Perfs-rate.png)

# Количество одновременных подключений # 

![Количество одновременных подключений](https://cppcomet.github.io/comet-server/HL-tests/HL-test1/20170608-1534/images/graphes-Users-simultaneous.png)



